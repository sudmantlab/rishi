#
mkdir -p /global/scratch/users/rdekayne/rockfish 

#####################################
#####################################
#            01_BUSCOS
#####################################
#####################################

mkdir -p /global/scratch/users/rdekayne/rockfish/01_BUSCOS && cd /global/scratch/users/rdekayne/rockfish/01_BUSCOS

#start by calculating buscos across the assemblies starting with the 19 that nicolas sent:
conda create -p /global/scratch/users/rdekayne/envs/busco
conda activate /global/scratch/users/rdekayne/envs/busco
conda install -c conda-forge -c bioconda busco=5.8.2

#19fasta_paths.txt
/global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/7164-PS-0001.bp.p_ctg.fa
/global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/7164-PS-0002.bp.p_ctg.fa
/global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/7164-PS-0003.bp.p_ctg.fa
/global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/7164-PS-0004.bp.p_ctg.fa
/global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/7164-PS-0005.bp.p_ctg.fa
/global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/7164-PS-0006.bp.p_ctg.fa
/global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/7164-PS-0007.bp.p_ctg.fa
/global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/7164-PS-0008.bp.p_ctg.fa
/global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/m84185_240412_222911_s4.bp.p_ctg.fa
/global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/SebastesalascanusSEB-2.bp.p_ctg.fa
/global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/SebastesalutusPOP6.bp.p_ctg.fa
/global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/SebastesborealisSEB-8.bp.p_ctg.fa
/global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/SebastescarnatusSEB-258.bp.p_ctg.fa
/global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/SebasteschrysomelasSEB-260.bp.p_ctg.fa
/global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/SebastescrocotulusSEB-252.bp.p_ctg.fa
/global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/SebastesmelanostictusSEB-4.bp.p_ctg.fa
/global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/SebastesminiatusSEB-256.bp.p_ctg.fa
/global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/SebastesmystinusSEB-254.bp.p_ctg.fa
/global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/SebastespolyspinisSEB-5.bp.p_ctg.fa
/global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/Sebastesruberrimus12-Yellowye1a.bp.p_ctg.fa
/global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/SebastesserranoidesSEB-259.bp.p_ctg.fa

sed -i 's/\/global\/scratch\/users\/nicolas931010\/rockfish_pangenome\/assembly\/fasta\///g' 19fasta_paths.txt

mkdir -p /global/scratch/users/rdekayne/rockfish/01_BUSCOS/rohit_assemblies
cp /global/scratch/p2p3/pl1_sudmant/rohitkolora/Rockfish/Genomes/FREEZE/WTDBG/Sebastes_entomelas/referencegenome.FASTA ./rohit_assemblies/Sebastes_entomelas.rohit.fa
cp /global/scratch/p2p3/pl1_sudmant/rohitkolora/Rockfish/Genomes/FREEZE/FALCON/Sebastes_aleutianus/referencegenome.FASTA ./rohit_assemblies/Sebastes_aleutianus.rohit.fa
cp /global/scratch/p2p3/pl1_sudmant/rohitkolora/Rockfish/Genomes/FREEZE/FALCON/Sebastes_miniatus/referencegenome.FASTA ./rohit_assemblies/Sebastes_miniatus.rohit.fa

##3fasta_paths.txt
/global/scratch/users/rdekayne/rockfish/01_BUSCOS/rohit_assemblies/Sebastes_entomelas.rohit.fa
/global/scratch/users/rdekayne/rockfish/01_BUSCOS/rohit_assemblies/Sebastes_aleutianus.rohit.fa
/global/scratch/users/rdekayne/rockfish/01_BUSCOS/rohit_assemblies/Sebastes_miniatus.rohit.fa

sed -i 's/\/global\/scratch\/users\/rdekayne\/rockfish\/01_BUSCOS\/rohit_assemblies\///g' 3fasta_paths.txt

##19wrun_test_busco.sh

#!/bin/bash
#SBATCH --job-name=busco
#SBATCH --time=0-24:00:00 # Wall clock time limit in Days-Hours:min:seconds
#SBATCH --account=co_genomicdata
#SBATCH --partition=savio4_htc
#SBATCH --output=busco%j.out # output file
#SBATCH --error=busco%j.err # error file
#SBATCH --ntasks=1 # Run 1 job
#SBATCH --ntasks-per-node=1 # One task per computer
#SBATCH --cpus-per-task=24 # 2 CPUs per job

numb=${SLURM_ARRAY_TASK_ID}
file_name=$(cat /global/scratch/users/rdekayne/rockfish/01_BUSCOS/19fasta_paths.txt | sed -n ${numb}p)

#now busco command
busco -c 24 -i /global/scratch/users/nicolas931010/rockfish_pangenome/assembly/fasta/${file_name} -o ${file_name}_busco -l actinopterygii_odb10 -m genome

touch ./done_files/${file_name}.done

##run
sbatch --array=1 19wrun_test_busco.sh
sbatch --array=2-21 19wrun_test_busco.sh

grep "C:" *.out

##output:
busco23000514.out:    |C:99.3%[S:98.5%,D:0.9%],F:0.5%,M:0.2%,n:3640,E:2.0%                                       |
busco23000515.out:    |C:99.3%[S:98.5%,D:0.8%],F:0.6%,M:0.1%,n:3640,E:2.2%                                       |
busco23000516.out:    |C:99.5%[S:98.7%,D:0.8%],F:0.4%,M:0.1%,n:3640,E:2.1%                                       |
busco23000517.out:    |C:99.3%[S:98.4%,D:0.9%],F:0.5%,M:0.1%,n:3640,E:2.2%                                       |
busco23000518.out:    |C:99.3%[S:98.5%,D:0.8%],F:0.6%,M:0.1%,n:3640,E:1.9%                                       |
busco23000519.out:    |C:99.5%[S:98.8%,D:0.7%],F:0.4%,M:0.1%,n:3640,E:2.0%                                       |
busco23000520.out:    |C:99.4%[S:98.6%,D:0.8%],F:0.5%,M:0.1%,n:3640,E:2.1%                                       |
busco23000521.out:    |C:99.4%[S:98.2%,D:1.2%],F:0.5%,M:0.1%,n:3640,E:1.9%                                       |
busco23000522.out:    |C:99.4%[S:98.5%,D:0.9%],F:0.5%,M:0.1%,n:3640,E:1.9%                                       |
busco23000523.out:    |C:99.4%[S:98.8%,D:0.5%],F:0.5%,M:0.1%,n:3640,E:2.0%                                       |
busco23000524.out:    |C:99.1%[S:98.4%,D:0.7%],F:0.7%,M:0.2%,n:3640,E:1.8%                                       |
busco23000525.out:    |C:99.3%[S:98.5%,D:0.8%],F:0.6%,M:0.1%,n:3640,E:2.0%                                       |
busco23000526.out:    |C:99.3%[S:98.5%,D:0.9%],F:0.5%,M:0.1%,n:3640,E:2.2%                                       |
busco23000527.out:    |C:99.3%[S:98.7%,D:0.5%],F:0.6%,M:0.1%,n:3640,E:2.0%                                       |
busco23000528.out:    |C:25.9%[S:25.6%,D:0.4%],F:4.8%,M:69.3%,n:3640,E:3.5%                                      |
busco23000529.out:    |C:99.5%[S:98.8%,D:0.6%],F:0.5%,M:0.1%,n:3640,E:2.1%                                       |
busco23000530.out:    |C:99.3%[S:98.5%,D:0.8%],F:0.5%,M:0.2%,n:3640,E:2.1%                                       |
busco23000531.out:    |C:99.4%[S:98.7%,D:0.7%],F:0.5%,M:0.1%,n:3640,E:2.2%                                       |
busco23000532.out:    |C:99.3%[S:98.3%,D:1.1%],F:0.5%,M:0.1%,n:3640,E:1.9%                                       |
busco23000533.out:    |C:99.3%[S:98.2%,D:1.1%],F:0.5%,M:0.1%,n:3640,E:2.0%                                       |
busco23000534.out:    |C:99.5%[S:98.9%,D:0.6%],F:0.4%,M:0.1%,n:3640,E:1.9%                                       |

for file in *.out
do
grep "Results written in" ${file}
grep "C:" ${file}
done

#remove black and yellow from list
rm -r SebasteschrysomelasSEB-260.bp.p_ctg.fa_busco/

##3wrun_test_busco.sh

#!/bin/bash
#SBATCH --job-name=busco
#SBATCH --time=0-24:00:00 # Wall clock time limit in Days-Hours:min:seconds
#SBATCH --account=co_genomicdata
#SBATCH --partition=savio4_htc
#SBATCH --output=busco%j.out # output file
#SBATCH --error=busco%j.err # error file
#SBATCH --ntasks=1 # Run 1 job
#SBATCH --ntasks-per-node=1 # One task per computer
#SBATCH --cpus-per-task=24 # 2 CPUs per job

numb=${SLURM_ARRAY_TASK_ID}
file_name=$(cat /global/scratch/users/rdekayne/rockfish/01_BUSCOS/3fasta_paths.txt | sed -n ${numb}p)

#now busco command
busco -c 24 -i /global/scratch/users/rdekayne/rockfish/01_BUSCOS/rohit_assemblies/${file_name} -o ${file_name}_busco -l actinopterygii_odb10 -m genome

touch ./done_files/${file_name}.done

##run
sbatch --array=1 3wrun_test_busco.sh
sbatch --array=2-3 3wrun_test_busco.sh

for file in busco2303832*.out
do
grep "Results written in" ${file}
grep "C:" ${file}
done

##
cd /global/scratch/users/rdekayne/rockfish/01_BUSCOS/rohit_assemblies/
#cp /global/scratch/users/nicolas931010/rockfish_popgen/references/ouc_korean/Ssc.HIC.genome.fa

#5fasta_paths.txt
Ssc.HIC.genome.fa
GCA_036937225.1_fSebPau1.0.hap1_genomic.fna
GCA_043250625.1_fSebFas1.pri_genomic.fna
GCA_045837885.1_fSebEnt1.0.p_genomic.fna
GCF_015220745.1_fSebUmb1.pri_genomic.fna

##5wrun_test_busco.sh

#!/bin/bash
#SBATCH --job-name=busco
#SBATCH --time=0-24:00:00 # Wall clock time limit in Days-Hours:min:seconds
#SBATCH --account=co_genomicdata
#SBATCH --partition=savio4_htc
#SBATCH --output=busco%j.out # output file
#SBATCH --error=busco%j.err # error file
#SBATCH --ntasks=1 # Run 1 job
#SBATCH --ntasks-per-node=1 # One task per computer
#SBATCH --cpus-per-task=24 # 2 CPUs per job

numb=${SLURM_ARRAY_TASK_ID}
file_name=$(cat /global/scratch/users/rdekayne/rockfish/01_BUSCOS/5fasta_paths.txt | sed -n ${numb}p)

#now busco command
busco -c 24 -i /global/scratch/users/rdekayne/rockfish/01_BUSCOS/rohit_assemblies/${file_name} -o ${file_name}_busco -l actinopterygii_odb10 -m genome

touch ./done_files/${file_name}.done

##run
sbatch --array=1 5wrun_test_busco.sh
sbatch --array=2-5 5wrun_test_busco.sh

for file in busco2304*.out
do
grep "Results written in" ${file}
grep "C:" ${file}
done


#####################################
#####################################
#            02_BUSCOS
#####################################
#####################################
l
## https://github.com/jamiemcg/BUSCO_phylogenomics?tab=readme-ov-file
git clone https://github.com/jamiemcg/BUSCO_phylogenomics
cd BUSCO_phylogenomics

conda env create -f conda_env.yaml
conda activate BUSCO_phylogenomics

mkdir -p /global/scratch/users/rdekayne/rockfish/01_BUSCOS/busco_output_folders

cp -r *.fa_busco busco_output_folders/
cp -r *.fna_busco busco_output_folders/

cd /global/scratch/users/rdekayne/rockfish/01_BUSCOS
python BUSCO_phylogenomics/BUSCO_phylogenomics.py -help

#run_BUSCO_phyhlogenomics.sh
#!/bin/bash
#SBATCH --job-name=busco
#SBATCH --time=0-24:00:00 # Wall clock time limit in Days-Hours:min:seconds
#SBATCH --account=co_genomicdata
#SBATCH --partition=savio4_htc
#SBATCH --output=busco_phylo%j.out # output file
#SBATCH --error=busco_phylo%j.err # error file
#SBATCH --ntasks=1 # Run 1 job
#SBATCH --ntasks-per-node=1 # One task per computer
#SBATCH --cpus-per-task=24 # 2 CPUs per job

python BUSCO_phylogenomics/BUSCO_phylogenomics.py -i ./busco_output_folders -o output_busco_phylogenomics --gene_trees_only --gene_tree_program iqtree -t 24

touch BUSCO_phylogenomics_run1.done

##run
sbatch run_BUSCO_phyhlogenomics.sh

conda install bioconda::astral-tree
git clone https://github.com/smirarab/ASTRAL/
module load openjdk/17.0.8.1_1-gcc-11.4.0
./make.sh

mkdir -p /global/scratch/users/rdekayne/rockfish/01_BUSCOS/astral_run1 && cd /global/scratch/users/rdekayne/rockfish/01_BUSCOS/astral_run1

##make_astral_tree.sh
#!/bin/bash
#SBATCH --job-name=astral
#SBATCH --time=0-24:00:00 # Wall clock time limit in Days-Hours:min:seconds
#SBATCH --account=co_genomicdata
#SBATCH --partition=savio4_htc
#SBATCH --output=astral%j.out # output file
#SBATCH --error=astral%j.err # error file
#SBATCH --ntasks=1 # Run 1 job
#SBATCH --ntasks-per-node=1 # One task per computer
#SBATCH --cpus-per-task=24 # 2 CPUs per job

java -jar /global/scratch/users/rdekayne/rockfish/01_BUSCOS/ASTRAL/astral.5.7.8.jar -i /global/scratch/users/rdekayne/rockfish/01_BUSCOS/output_busco_phylogenomics/gene_trees_single_copy/ALL.tree -o all_buscos_28rockfish.tre
touch tree.done

##run
sbatch make_astral_tree.sh

cp all_buscos_28rockfish.tre all_buscos_28rockfish_renamed.tre

sed -i 's/7164-PS-0001.bp.p_ctg.fa_busco/copper_7164-PS-0001/g' all_buscos_28rockfish_renamed.tre
sed -i 's/7164-PS-0002.bp.p_ctg.fa_busco/black_7164-PS-0002/g' all_buscos_28rockfish_renamed.tre
sed -i 's/7164-PS-0003.bp.p_ctg.fa_busco/rougheye1_7164-PS-0003/g' all_buscos_28rockfish_renamed.tre
sed -i 's/7164-PS-0004.bp.p_ctg.fa_busco/widow_7164-PS-0004/g' all_buscos_28rockfish_renamed.tre
sed -i 's/7164-PS-0005.bp.p_ctg.fa_busco/yellowtail_7164-PS-0005/g' all_buscos_28rockfish_renamed.tre
sed -i 's/7164-PS-0006.bp.p_ctg.fa_busco/pop_b_7164-PS-0006/g' all_buscos_28rockfish_renamed.tre
sed -i 's/7164-PS-0007.bp.p_ctg.fa_busco/light_dusky_7164-PS-0007/g' all_buscos_28rockfish_renamed.tre
sed -i 's/7164-PS-0008.bp.p_ctg.fa_busco/quillbac_7164-PS-0008k/g' all_buscos_28rockfish_renamed.tre
sed -i 's/m84185_240412_222911_s4.bp.p_ctg.fa_busco/deacon_m84185_240412_222911_s4/g' all_buscos_28rockfish_renamed.tre
sed -i 's/SebastesalascanusSEB-2.bp.p_ctg.fa_busco/shortspine_thornyhead_SebastesalascanusSEB-2/g' all_buscos_28rockfish_renamed.tre
sed -i 's/Sebastes_aleutianus.rohit.fa_busco/rougheye_Sebastes_aleutianus.rohit/g' all_buscos_28rockfish_renamed.tre
sed -i 's/SebastesalutusPOP6.bp.p_ctg.fa_busco/pop_a_SebastesalutusPOP6/g' all_buscos_28rockfish_renamed.tre
sed -i 's/SebastesborealisSEB-8.bp.p_ctg.fa_busco/shortraker_SebastesborealisSEB-8/g' all_buscos_28rockfish_renamed.tre
sed -i 's/SebastescarnatusSEB-258.bp.p_ctg.fa_busco/gopher_SebastescarnatusSEB-258/g' all_buscos_28rockfish_renamed.tre
sed -i 's/SebastescrocotulusSEB-252.bp.p_ctg.fa_busco/sunset_SebastescrocotulusSEB-252/g' all_buscos_28rockfish_renamed.tre
sed -i 's/Sebastes_entomelas.rohit.fa_busco/widow_Sebastes_entomelas.rohit/g' all_buscos_28rockfish_renamed.tre
sed -i 's/SebastesmelanostictusSEB-4.bp.p_ctg.fa_busco/blackspotted_SebastesmelanostictusSEB-4/g' all_buscos_28rockfish_renamed.tre
sed -i 's/Sebastes_miniatus.rohit.fa_busco/vermilion_Sebastes_miniatus.rohit/g' all_buscos_28rockfish_renamed.tre
sed -i 's/SebastesminiatusSEB-256.bp.p_ctg.fa_busco/vermilion_SebastesminiatusSEB-256/g' all_buscos_28rockfish_renamed.tre
sed -i 's/SebastesmystinusSEB-254.bp.p_ctg.fa_busco/blue_SebastesmystinusSEB-254/g' all_buscos_28rockfish_renamed.tre
sed -i 's/SebastespolyspinisSEB-5.bp.p_ctg.fa_busco/northern_SebastespolyspinisSEB-5/g' all_buscos_28rockfish_renamed.tre
sed -i 's/Sebastesruberrimus12-Yellowye1a.bp.p_ctg.fa_busco/yelloweye_Sebastesruberrimus12-Yellowye1a/g' all_buscos_28rockfish_renamed.tre
sed -i 's/SebastesserranoidesSEB-259.bp.p_ctg.fa_busco/olive_SebastesserranoidesSEB-259/g' all_buscos_28rockfish_renamed.tre
sed -i 's/Ssc.HIC.genome.fa_busco/korean_Ssc.HIC/g' all_buscos_28rockfish_renamed.tre
sed -i 's/GCA_036937225.1_fSebPau1.0.hap1_genomic.fna_busco/bocaccio_GCA_036937225.1_fSebPau1/g' all_buscos_28rockfish_renamed.tre
sed -i 's/GCA_043250625.1_fSebFas1.pri_genomic.fna_busco/acadian_redfish_GCA_043250625.1_fSebFas1/g' all_buscos_28rockfish_renamed.tre
sed -i 's/GCA_045837885.1_fSebEnt1.0.p_genomic.fna_busco/widow_GCA_045837885.1_fSebEnt1/g' all_buscos_28rockfish_renamed.tre
sed -i 's/GCF_015220745.1_fSebUmb1.pri_genomic.fna_busco/honeycomb_GCF_015220745.1_fSebUmb1/g' all_buscos_28rockfish_renamed.tre

#filter tree to only include the following
-rw-r--r-- 1 nicolas931010 co_genomicdata 814M Jan  4  2024 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/7164-PS-0001.masked
-rw-r--r-- 1 nicolas931010 co_genomicdata 811M Jan  5  2024 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/7164-PS-0002.masked
-rw-r--r-- 1 nicolas931010 co_genomicdata 824M Jan  5  2024 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/7164-PS-0003.masked
-rw-r--r-- 1 nicolas931010 co_genomicdata 810M Jan  5  2024 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/7164-PS-0004.masked
-rw-r--r-- 1 nicolas931010 co_genomicdata 818M Jan  5  2024 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/7164-PS-0005.masked
-rw-r--r-- 1 nicolas931010 co_genomicdata 819M Jan  5  2024 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/7164-PS-0006.masked
-rw-r--r-- 1 nicolas931010 co_genomicdata 848M Jan  5  2024 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/7164-PS-0007.masked
-rw-r--r-- 1 nicolas931010 co_genomicdata 813M Jan  5  2024 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/7164-PS-0008.masked
-rw-r--r-- 1 nicolas931010 ucb            785M Jan 21 17:43 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/GCA_036937225.1_fSebPau1.0.hap1_genomic.fna.masked
-rw-r--r-- 1 nicolas931010 ucb            812M Jan 21 17:46 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/GCA_043250625.1_fSebFas1.pri_genomic.fna.masked
-rw-r--r-- 1 nicolas931010 ucb            801M Jan 21 17:46 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/GCA_045837885.1_fSebEnt1.0.p_genomic.fna.masked
-rw-r--r-- 1 nicolas931010 ucb            780M Jan 21 17:38 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/GCF_015220745.1_fSebUmb1.pri_genomic.fna.masked
-rw-r--r-- 1 nicolas931010 ucb            796M Jan 21 14:44 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/m84185_240412_222911_s4.masked
-rw-r--r-- 1 nicolas931010 co_genomicdata 786M Jan  5  2024 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/rougheye-kolora.masked
-rw-r--r-- 1 nicolas931010 ucb            889M Jan 21 14:50 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/SebastesalascanusSEB-2.masked
-rw-r--r-- 1 nicolas931010 ucb            824M Jan 21 14:35 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/SebastesalutusPOP6.masked
-rw-r--r-- 1 nicolas931010 ucb            870M Jan 21 14:54 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/SebastesborealisSEB-8.masked
-rw-r--r-- 1 nicolas931010 ucb            810M Jan 21 14:37 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/SebastescarnatusSEB-258.masked
-rw-r--r-- 1 nicolas931010 ucb            170M Jan 21 13:47 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/SebasteschrysomelasSEB-260.masked
-rw-r--r-- 1 nicolas931010 ucb            800M Jan 21 14:35 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/SebastescrocotulusSEB-252.masked
-rw-r--r-- 1 nicolas931010 ucb            834M Jan 21 14:41 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/SebastesmelanostictusSEB-4.masked
-rw-r--r-- 1 nicolas931010 ucb            802M Jan 21 14:35 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/SebastesminiatusSEB-256.masked
-rw-r--r-- 1 nicolas931010 ucb            804M Jan 21 14:33 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/SebastesmystinusSEB-254.masked
-rw-r--r-- 1 nicolas931010 ucb            846M Jan 21 14:37 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/SebastespolyspinisSEB-5.masked
-rw-r--r-- 1 nicolas931010 ucb            800M Jan 21 14:51 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/Sebastesruberrimus12-Yellowye1a.masked
-rw-r--r-- 1 nicolas931010 ucb            807M Jan 21 14:32 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/SebastesserranoidesSEB-259.masked
-rw-r--r-- 1 nicolas931010 ucb            790M Jan 21 17:36 /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/Ssc.HIC.genome.fa.masked

#####################################
#####################################
#            03_CACTUS
#####################################
#####################################
mkdir -p /global/scratch/users/rdekayne/rockfish/03_CACTUS && cd /global/scratch/users/rdekayne/rockfish/03_CACTUS

#followed installation instructions at: https://github.com/ComparativeGenomicsToolkit/cactus/blob/v2.9.3/README.md
# https://docs-research-it.berkeley.edu/services/high-performance-computing/user-guide/software/using-software/using-singularity-savio/#trying-things-out-on-a-login-node
#now do test:

#test_cactus.sh
#!/bin/bash
#SBATCH --job-name=cactus_test
#SBATCH --time=0-24:00:00 # Wall clock time limit in Days-Hours:min:seconds
#SBATCH --account=co_genomicdata
#SBATCH --partition=savio4_htc
#SBATCH --output=cactus_test%j.out # output file
#SBATCH --error=cactus_test%j.err # error file
#SBATCH --ntasks=1 # Run 1 job
#SBATCH --ntasks-per-node=1 # One task per computer
#SBATCH --cpus-per-task=24 # 2 CPUs per job

cactus ./js ./examples/evolverMammals.txt ./evolverMammals.hal --binariesMode singularity

##new time
cd /global/scratch/users/rdekayne/rockfish/03_CACTUS/cactus
source cactus_env/bin/activate

#test_26rockfish_alignment.sh
#!/bin/bash
#SBATCH --job-name=cactus_test
#SBATCH --time=0-24:00:00 # Wall clock time limit in Days-Hours:min:seconds
#SBATCH --account=co_genomicdata
#SBATCH --partition=savio4_htc
#SBATCH --output=cactus_test%j.out # output file
#SBATCH --error=cactus_test%j.err # error file
#SBATCH --ntasks=1 # Run 1 job
#SBATCH --ntasks-per-node=1 # One task per computer
#SBATCH --cpus-per-task=24 # 2 CPUs per job

cactus ./js ../cactus_input_26rockfish.txt ./26_rockfish.hal --binariesMode singularity

##RUN
sbatch test_26rockfish_alignment.sh

#now HAL

#run_halval_and_halstat.sh

#!/bin/bash
#SBATCH --job-name=cactus_test
#SBATCH --time=0-24:00:00 # Wall clock time limit in Days-Hours:min:seconds
#SBATCH --account=co_genomicdata
#SBATCH --partition=savio4_htc
#SBATCH --output=cactus_test%j.out # output file
#SBATCH --error=cactus_test%j.err # error file
#SBATCH --ntasks=1 # Run 1 job
#SBATCH --ntasks-per-node=1 # One task per computer
#SBATCH --cpus-per-task=24 # 2 CPUs per job

singularity pull docker://quay.io/comparative-genomics-toolkit/cactus:v2.9.3
singularity run cactus_v2.9.3.sif
halValidate ./26_rockfish.hal
halStats ./26_rockfish.hal

hal v2.2
((korean-ouc:1,(((SebastesborealisSEB-8:1,(SebastesmelanostictusSEB-4:1,(rougheye-kolora:1,7164-PS-0003:1)Anc15:0.246209)Anc09:0.301513)Anc05:0.0999126,(acadian-vgp:1,((SebastesalutusPOP6:1,7164-PS-0006:1)Anc16:0.713092,(SebastespolyspinisSEB-5:1,7164-PS-0007:1)Anc17:0.453406)Anc10:0.150332)Anc06:0.0244786)Anc03:0.0961719,((((bocaccio-ccgp:1,honeycomb-vgp:1)Anc18:0.0158201,(SebastescarnatusSEB-258:1,(7164-PS-0001:1,7164-PS-0008:1)Anc24:0.0112265)Anc19:0.841649)Anc11:0.00442815,(Sebastesruberrimus12-Yellowye1a:1,(SebastescrocotulusSEB-252:1,SebastesminiatusSEB-256:1.027)Anc20:0.868767)Anc12:0.00729953)Anc07:0.0864933,((SebastesserranoidesSEB-259:1,(7164-PS-0005:1,7164-PS-0002:1)Anc21:0.287969)Anc13:0.387429,((m84185_240412_222911_s4:1,SebastesmystinusSEB-254:1)Anc22:0.411042,(widow-ccgp:1.0081,7164-PS-0004:1)Anc23:0.609105)Anc14:0.304319)Anc08:0.173494)Anc04:0.0643379)Anc02:0.0789716)Anc01:0.5,SebastesalascanusSEB-2:0.5)Anc00;

GenomeName, NumChildren, Length, NumSequences, NumTopSegments, NumBottomSegments
Anc00, 2, 610378001, 1, 0, 17715687
Anc01, 2, 748295405, 1, 21294161, 25701942
korean-ouc, 0, 811820114, 66, 26726022, 0
Anc02, 2, 762595800, 1, 26076406, 23094049
Anc03, 2, 766423028, 1, 23109660, 5276400
Anc05, 2, 783742944, 1, 5355012, 8593504
SebastesborealisSEB-8, 0, 893916515, 243, 9211391, 0
Anc09, 2, 788767757, 7, 8639818, 7996347
SebastesmelanostictusSEB-4, 0, 856566335, 217, 8433692, 0
Anc15, 2, 797138060, 22, 8112147, 5066163
rougheye-kolora, 0, 807295316, 168, 5257247, 0
7164-PS-0003, 0, 847028045, 216, 5336925, 0
Anc06, 2, 770043350, 1, 5275816, 8966150
acadian-vgp, 0, 833835073, 203, 9271088, 0
Anc10, 2, 773413633, 3, 9060729, 9323699
Anc16, 2, 799902269, 27, 9459848, 9328751
SebastesalutusPOP6, 0, 846987306, 212, 9709890, 0
7164-PS-0006, 0, 841753079, 227, 9690797, 0
Anc17, 2, 803568655, 26, 9589273, 10306365
SebastespolyspinisSEB-5, 0, 868972730, 432, 10912764, 0
7164-PS-0007, 0, 871379929, 349, 10844659, 0
Anc04, 2, 764536174, 1, 23069703, 4557882
Anc07, 2, 766935735, 1, 4576752, 3767323
Anc11, 2, 766747158, 3, 3745676, 6060525
Anc18, 2, 770233367, 18, 6156446, 10126115
bocaccio-ccgp, 0, 806866550, 211, 10048998, 0
honeycomb-vgp, 0, 800904020, 138, 10462078, 0
Anc19, 2, 784252591, 13, 6220747, 6512775
SebastescarnatusSEB-258, 0, 832185576, 212, 6851889, 0
Anc24, 2, 797534477, 31, 6670643, 4035615
7164-PS-0001, 0, 836676697, 231, 4311129, 0
7164-PS-0008, 0, 835697227, 222, 4373426, 0
Anc12, 2, 775847372, 14, 3812667, 7086623
Sebastesruberrimus12-Yellowye1a, 0, 821387232, 168, 7401932, 0
Anc20, 2, 794291541, 34, 7216807, 6859423
SebastescrocotulusSEB-252, 0, 821912870, 178, 7174837, 0
SebastesminiatusSEB-256, 0, 823860536, 185, 7196826, 0
Anc08, 2, 765801593, 2, 4586270, 7498378
Anc13, 2, 777777433, 8, 7586873, 7793213
SebastesserranoidesSEB-259, 0, 829077004, 177, 8079206, 0
Anc21, 2, 795471234, 31, 7944265, 4880773
7164-PS-0005, 0, 840056201, 174, 5197304, 0
7164-PS-0002, 0, 833617282, 197, 5149647, 0
Anc14, 2, 773686071, 6, 7634553, 7946225
Anc22, 2, 788268860, 33, 8078445, 8090166
m84185_240412_222911_s4, 0, 817533266, 259, 8355738, 0
SebastesmystinusSEB-254, 0, 825552957, 176, 8473682, 0
Anc23, 2, 797279714, 25, 8189174, 4824876
widow-ccgp, 0, 823288076, 99, 5050335, 0
7164-PS-0004, 0, 832493062, 319, 5114535, 0
SebastesalascanusSEB-2, 0, 913527757, 414, 22584081, 0

halSummarizeMutations ./26_rockfish.hal

#######################################################################################################
#######################################################################################################
#                            HAL-MAF-MSA-TREE TEST
#######################################################################################################
#######################################################################################################
#just want a maf for these three
SebastesalascanusSEB-2  /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/SebastesalascanusSEB-2.fa.masked
SebastesalutusPOP6      /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/SebastesalutusPOP6.fa.masked
SebastesborealisSEB-8   /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/SebastesborealisSEB-8.fa.masked

cd /global/scratch/users/rdekayne/rockfish/03_CACTUS/cactus
source cactus_env/bin/activate
cactus-hal2maf -h

#test_hal_to_maf.sh

#!/bin/bash
#SBATCH --job-name=cactus_test
#SBATCH --time=0-24:00:00 # Wall clock time limit in Days-Hours:min:seconds
#SBATCH --account=co_genomicdata
#SBATCH --partition=savio4_htc
#SBATCH --output=cactus_test%j.out # output file
#SBATCH --error=cactus_test%j.err # error file
#SBATCH --ntasks=1 # Run 1 job
#SBATCH --mem=100G
#SBATCH --ntasks-per-node=1 # One task per computer
#SBATCH --cpus-per-task=24 # 2 CPUs per job

export TMPDIR=/global/scratch/users/rdekayne/rockfish/maf_test/test_tmp

singularity exec -B /global/scratch/users/rdekayne/rockfish/maf_test/test_tmp ../03_CACTUS/cactus_v2.9.3.sif cactus-hal2maf ./js ../03_CACTUS/26_rockfish.hal test.maf --refGenome SebastesalascanusSEB-2 --noAncestors --targetGenomes SebastesalascanusSEB-2,SebastesalutusPOP6,SebastesborealisSEB-8 --bedRanges test.bed --chunkSize 1000000 --batchMemory 50G --maxMemory 100G

#run
sbatch test_hal_to_maf.sh

#test_hal_to_maf_all.sh

#!/bin/bash
#SBATCH --job-name=cactus_test
#SBATCH --time=0-24:00:00 # Wall clock time limit in Days-Hours:min:seconds
#SBATCH --account=co_genomicdata
#SBATCH --partition=savio4_htc
#SBATCH --output=cactus_test%j.out # output file
#SBATCH --error=cactus_test%j.err # error file
#SBATCH --ntasks=1 # Run 1 job
#SBATCH --mem=100G
#SBATCH --ntasks-per-node=1 # One task per computer
#SBATCH --cpus-per-task=24 # 2 CPUs per job

export TMPDIR=/global/scratch/users/rdekayne/rockfish/maf_test/test_tmp

singularity exec -B /global/scratch/users/rdekayne/rockfish/maf_test/test_tmp ../03_CACTUS/cactus_v2.9.3.sif cactus-hal2maf ./js ../03_CACTUS/26_rockfish.hal test.maf --refGenome SebastesalascanusSEB-2 --noAncestors --bedRanges test.bed --chunkSize 1000000 --batchMemory 50G --maxMemory 100G

#run
sbatch test_hal_to_maf_all.sh

#now to get from maf to fasta
conda create -p /global/scratch/users/rdekayne/envs/maf_manipulation
conda activate /global/scratch/users/rdekayne/envs/maf_manipulation
conda install bioconda::phast
conda install bioconda::seqkit

msa_view test.maf -f -G 1 --unmask | seqkit seq -w 0 > test.fasta
sed -e 's/\*/-/g' test.fasta > test.gap-replaced.fasta

#and for all file
#http://compgen.cshl.edu/phast/help-pages/msa_view.txt
msa_view test.maf -f -G 1 --unmask | seqkit seq -w 0 > test_all.fasta
sed -e 's/\*/-/g' test_all.fasta > test_all.gap-replaced.fasta

msa_view test.maf -f -G 1 --seqs SebastesalascanusSEB-2,SebastesalutusPOP6,SebastesborealisSEB-8 --unmask | seqkit seq -w 0 > test_3.fasta
sed -e 's/\*/-/g' test_3.fasta > test_3.gap-replaced.fasta

conda create -p /global/scratch/users/rdekayne/envs/trees
conda activate /global/scratch/users/rdekayne/envs/trees
conda install bioconda::raxml
conda install bioconda::pargenes
conda install bedtools
conda install samtools
conda install conda-forge::ete3

git clone --recursive https://github.com/BenoitMorel/ParGenes.git
cd ParGenes
module load cmake/3.27.7 
./install.sh 10

cd /global/scratch/users/rdekayne/rockfish
mkdir ./pargenes_test
mkdir ./pargenes_test/msa_files
cp ./maf_test/test_3.gap-replaced.fasta pargenes_test/msa_files/

sed -e 's/-/N/g' test_3.gap-replaced.fasta > test_3.gap-replaced_NODASH.fasta
sed -i 's/> />/g' TEST.fasta
/global/scratch/users/rdekayne/rockfish/maf_test/ParGenes/pargenes/pargenes.py -a ./msa_files -o ./alignment_test_out --cores 64 -d nt -m --job-failure-fatal --use-astral

https://github.com/owensgl/maf_explore/blob/main/maf2alignmentstats.pl

#######################################################################################################
#######################################################################################################
#                            FULL RUN
#######################################################################################################
#######################################################################################################
200k 152

cd /global/scratch/users/rdekayne/rockfish/maf_run
cp /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/fasta/SebastesalascanusSEB-2.fa.masked .
samtools faidx SebastesalascanusSEB-2.fa.masked
cut -f1,2 SebastesalascanusSEB-2.fa.masked.fai > sizes.genome
bedtools makewindows -g sizes.genome -w 50000 > 50kb.txt 

cd /global/scratch/users/rdekayne/rockfish/03_CACTUS/cactus
source cactus_env/bin/activate
cd /global/scratch/users/rdekayne/rockfish/maf_run100

#run_hal2maf_windows.sh
#!/bin/bash
#SBATCH --job-name=cactus_test
#SBATCH --time=0-24:00:00 # Wall clock time limit in Days-Hours:min:seconds
#SBATCH --account=co_genomicdata
#SBATCH --partition=savio4_htc
#SBATCH --output=cactus_test%j.out # output file
#SBATCH --error=cactus_test%j.err # error file
#SBATCH --ntasks=1 # Run 1 job
#SBATCH --mem=100G
#SBATCH --ntasks-per-node=1 # One task per computer
#SBATCH --cpus-per-task=24 # 2 CPUs per job

export TMPDIR=/global/scratch/users/rdekayne/rockfish/maf_test/test_tmp

numb=${SLURM_ARRAY_TASK_ID}

cat /global/scratch/users/rdekayne/rockfish/maf_run/50kb.txt | sed -n ${numb}p > ${numb}.bed

singularity exec -B /global/scratch/users/rdekayne/rockfish/maf_test/test_tmp ../03_CACTUS/cactus_v2.9.3.sif cactus-hal2maf ./${numb}_js ../03_CACTUS/26_rockfish.hal ${numb}.maf --refGenome SebastesalascanusSEB-2 --noAncestors --bedRanges ${numb}.bed --chunkSize 1000000 --batchMemory 25G --maxMemory 50G

###run
mkdir maf_output
sbatch --array=1-1000%10 run_hal2maf_windows.sh
ls *_js
rm -r 163_js
rm 163.bed
rm -r 164_js
rm 164.bed
rm -r 500_js
rm 500.bed
rm -r 561_js
rm 561.bed
sbatch --array=163,164,500,561 run_hal2maf_windows.sh
mv *.maf maf_output
cp -r maf_output/ maf_output_1to1000

sbatch --array=1001-2000%5 run_hal2maf_windows.sh
sbatch --array=2001-3000%10 run_hal2maf_windows.sh
sbatch --array=3001-4000%10 run_hal2maf_windows.sh
sbatch --array=4001-5000%10 run_hal2maf_windows.sh
sbatch --array=5001-6000%10 run_hal2maf_windows.sh
sbatch --array=6001-7000%10 run_hal2maf_windows.sh
sbatch --array=7001-8000%10 run_hal2maf_windows.sh
sbatch --array=8001-9000%10 run_hal2maf_windows.sh
sbatch --array=9001-10000%10 run_hal2maf_windows.sh
sbatch --array=10001-11000%10 run_hal2maf_windows.sh
sbatch --array=11001-12000%10 run_hal2maf_windows.sh
sbatch --array=12001-13000%10 run_hal2maf_windows.sh
sbatch --array=13001-14000%10 run_hal2maf_windows.sh
sbatch --array=14001-15000%10 run_hal2maf_windows.sh
sbatch --array=15001-16000%10 run_hal2maf_windows.sh
sbatch --array=16001-17000%10 run_hal2maf_windows.sh
sbatch --array=17001-18000%10 run_hal2maf_windows.sh
sbatch --array=18001-18527%10 run_hal2maf_windows.sh

#1-608
mkdir msa_files_ptg000001l

conda activate /global/scratch/users/rdekayne/envs/maf_manipulation

#convert_maf2fasta.sh
#!/bin/bash
#SBATCH --job-name=cactus_test
#SBATCH --time=0-24:00:00 # Wall clock time limit in Days-Hours:min:seconds
#SBATCH --account=co_genomicdata
#SBATCH --partition=savio4_htc
#SBATCH --output=cactus_test%j.out # output file
#SBATCH --error=cactus_test%j.err # error file
#SBATCH --ntasks=1 # Run 1 job
#SBATCH --mem=100G
#SBATCH --ntasks-per-node=1 # One task per computer
#SBATCH --cpus-per-task=24 # 2 CPUs per job

export TMPDIR=/global/scratch/users/rdekayne/rockfish/maf_test/test_tmp

numb=${SLURM_ARRAY_TASK_ID}

msa_view ${numb}.maf -f -G 1 --unmask | seqkit seq -w 0 > ${numb}.fasta
sed -e 's/\*/N/g' ${numb}.fasta > ${numb}.gap-replaced.fasta
sed -i 's/> />/g' ${numb}.gap-replaced.fasta
cp ${numb}.gap-replaced.fasta ./msa_files_ptg000001l/${numb}.gap-replaced.fasta

###run
sbatch --array=1-608%10 convert_maf2fasta.sh

conda activate /global/scratch/users/rdekayne/envs/trees

#run_pargenes.sh
#!/bin/bash
#SBATCH --job-name=pargenes
#SBATCH --time=0-24:00:00 # Wall clock time limit in Days-Hours:min:seconds
#SBATCH --account=co_genomicdata
#SBATCH --partition=savio4_htc
#SBATCH --output=pargenes%j.out # output file
#SBATCH --error=pargenes%j.err # error file
#SBATCH --ntasks=1 # Run 1 job
#SBATCH --mem=100G
#SBATCH --ntasks-per-node=1 # One task per computer
#SBATCH --cpus-per-task=56 # 2 CPUs per job

/global/scratch/users/rdekayne/rockfish/maf_test/ParGenes/pargenes/pargenes-hpc.py -a ./msa_files_ptg000001l -o ./alignment_test_out_ptg000001l --cores 56 -d nt -m --job-failure-fatal --use-astral

##run
sbatch run_pargenes.sh

ls -v ./alignment_test_out_ptg000001l/modeltest_run/results/*_gap-replaced_fasta/*_gap-replaced_fasta.tree

#
for file in */*.log; do grep "Execution log" ${file} >> 200kblog.summary; grep "Invariant" ${file} >> 200kblog.summary; done
sed -i 's/\/global\/scratch\/users\/rdekayne\/rockfish\/maf_run100\/maf_output_chr1\/alignment_test_out_ptg000001l\/mlsearch_run\/results\///g' 200kblog.summary


#####################################
#####################################
#            04_CAT_ANNO
#####################################
#####################################

mkdir -p /global/scratch/users/rdekayne/rockfish/04_CAT_ANNO && cd /global/scratch/users/rdekayne/rockfish/04_CAT_ANNO

###annotation
https://bioconda.github.io/recipes/comparative-annotation-toolkit/README.html

singularity build CAT.sif docker://github.com/ComparativeGenomicsToolkit/Comparative-Annotation-Toolkit/tree/master
singularity pull docker:://hub.docker.com/r/realtkd/comparative-annotation-toolkit/


singularity pull docker://hub.docker.com/r/realtkd/comparative-annotation-toolkit:20190220
singularity run cactus_v2.9.3.sif
halValidate --help
halStats --help
singularity run cactus_v2.9.3.sif


#########################################################################
mkdir -p /global/scratch/users/rdekayne/rockfish50/

#####################################
#####################################
#            01_BUSCOS
#####################################
#####################################
mkdir -p /global/scratch/users/rdekayne/rockfish50/01_BUSCOS
mkdir -p /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas
mkdir -p /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas
mkdir -p /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/output_busco_phylogenomics
cd /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas
cp /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/hap1/*.masked .

for file in *.masked
do
mv ${file} ${file}.hap1
done

cd /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas
cp /global/scratch/users/nicolas931010/rockfish_pangenome/repeat_annotation/repeatmasker/hap2/*.masked .

for file in *.masked
do
mv ${file} ${file}.hap2
done

cd ../
ls hap1_masked_fastas/*.hap1 >> hap12_file_paths.txt
ls hap2_masked_fastas/*.hap2 >> hap12_file_paths.txt

conda activate /global/scratch/users/rdekayne/envs/busco

#50_rockfish_buscos.sh 

#!/bin/bash
#SBATCH --job-name=busco
#SBATCH --time=0-24:00:00 # Wall clock time limit in Days-Hours:min:seconds
#SBATCH --account=co_genomicdata
#SBATCH --partition=savio4_htc
#SBATCH --output=busco%j.out # output file
#SBATCH --error=busco%j.err # error file
#SBATCH --ntasks=1 # Run 1 job
#SBATCH --ntasks-per-node=1 # One task per computer
#SBATCH --cpus-per-task=24 # 2 CPUs per job

numb=${SLURM_ARRAY_TASK_ID}
file_name=$(cat /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap12_file_paths.txt | sed -n ${numb}p)

#now busco command
busco -c 24 -i ${file_name} -o output_busco_phylogenomics/${file_name}_busco -l actinopterygii_odb10 -m genome

touch ./all.done

##run
sbatch --array=1-50%1 50_rockfish_buscos.sh 


for file in *.out
do
grep "Input file" ${file}
grep "C:" ${file}
done

mkdir -p /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/output_busco_phylogenomics/all_busco_output
cd /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/output_busco_phylogenomics/hap1_masked_fastas
cp -r *_busco ../all_busco_output

cd /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/output_busco_phylogenomics/hap2_masked_fastas
cp -r *_busco ../all_busco_output


#####################################
#####################################
#            02_TREES
#####################################
#####################################

mkdir -p /global/scratch/users/rdekayne/rockfish50/02_TREES && cd /global/scratch/users/rdekayne/rockfish50/02_TREES
conda activate BUSCO_phylogenomics

#python BUSCO_phylogenomics/BUSCO_phylogenomics.py -help

#run_BUSCO_phyhlogenomics.sh
#!/bin/bash
#SBATCH --job-name=busco
#SBATCH --time=0-24:00:00 # Wall clock time limit in Days-Hours:min:seconds
#SBATCH --account=co_genomicdata
#SBATCH --partition=savio4_htc
#SBATCH --qos=genomicdata_htc4_normal
#SBATCH --output=busco_phylo%j.out # output file
#SBATCH --error=busco_phylo%j.err # error file
#SBATCH --ntasks=1 # Run 1 job
#SBATCH --ntasks-per-node=1 # One task per computer
#SBATCH --cpus-per-task=24 # 2 CPUs per job

python /global/scratch/users/rdekayne/rockfish/01_BUSCOS/BUSCO_phylogenomics/BUSCO_phylogenomics.py  -i /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/output_busco_phylogenomics/all_busco_output/ -o ./output_busco_phylogenomics --gene_trees_only --gene_tree_program iqtree -t 24

touch BUSCO_phylogenomics_run1.done

##run
sbatch run_BUSCO_phyhlogenomics.sh

conda install bioconda::astral-tree
git clone https://github.com/smirarab/ASTRAL/
module load openjdk/17.0.8.1_1-gcc-11.4.0
./make.sh

mkdir -p /global/scratch/users/rdekayne/rockfish/01_BUSCOS/astral_run1 && cd /global/scratch/users/rdekayne/rockfish/01_BUSCOS/astral_run1

##make_astral_tree.sh
#!/bin/bash
#SBATCH --job-name=astral
#SBATCH --time=0-24:00:00 # Wall clock time limit in Days-Hours:min:seconds
#SBATCH --account=co_genomicdata
#SBATCH --partition=savio4_htc
#SBATCH --output=astral%j.out # output file
#SBATCH --error=astral%j.err # error file
#SBATCH --ntasks=1 # Run 1 job
#SBATCH --ntasks-per-node=1 # One task per computer
#SBATCH --cpus-per-task=24 # 2 CPUs per job

java -jar /global/scratch/users/rdekayne/rockfish/01_BUSCOS/ASTRAL/astral.5.7.8.jar -i /global/scratch/users/rdekayne/rockfish50/02_TREES/output_busco_phylogenomics/gene_trees_single_copy/ALL.tree -o all_buscos_50rockfish.tre
touch tree.done

##run
sbatch make_astral_tree.sh

#####################################
#####################################
#            03_CACTUS
#####################################
#####################################
mkdir -p /global/scratch/users/rdekayne/rockfish50/03_CACTUS && cd /global/scratch/users/rdekayne/rockfish50/03_CACTUS

cp ../02_TREES/all_buscos_50rockfish.tre ./cactus_input_tree_rockfish50.tre

sed -i 's/Sebastes_aleutianus_rougheye.rohit.fa.hap1_busco/Sebastes_aleutianus_rougheye/g' cactus_input_tree_rockfish50.tre
sed -i 's/Ssc.HIC_korean.fa.hap1_busco/Ssc.HIC_korean/g' cactus_input_tree_rockfish50.tre
sed -i 's/.fa.masked.hap1_busco/.1/g' cactus_input_tree_rockfish50.tre
sed -i 's/.fa.masked.hap2_busco/.2/g' cactus_input_tree_rockfish50.tre

#input cactus file:
##cactus_input_50rockfish.txt
(Ssc.HIC_korean,((SebastesalascanusSEB-2_shortspinethornyhead.1,SebastesalascanusSEB-2_shortspinethornyhead.2)1:4.084433495564716,((((SebastesborealisSEB-8_shortraker.1,SebastesborealisSEB-8_shortraker.2)1:0.7789235089108395,((SebastesmelanostictusSEB-4_blackspotted.1,SebastesmelanostictusSEB-4_blackspotted.2)1:0.22433104492464048,(Sebastes_aleutianus_rougheye,(7164-PS-0003_rougheye.1,7164-PS-0003_rougheye.2)0.84:0.020083284392738942)1:0.2828645729677182)1:0.2979681488386202)1:0.09774672136103887,((acadian-vgp.2,acadian-vgp.1)1:1.2613218338213825,(((7164-PS-0006_popb.1,7164-PS-0006_popb.2)0.99:0.031693555833783096,(SebastesalutusPOP6_popa.1,SebastesalutusPOP6_popa.2)0.85:0.019678405371807504)1:0.7141528384091491,((SebastespolyspinisSEB-5_northern.1,SebastespolyspinisSEB-5_northern.2)1:0.3325954526781119,(7164-PS-0007_lightdusky.1,7164-PS-0007_lightdusky.2)1:0.35169920083306605)1:0.459831293441406)1:0.14960374563653508)0.92:0.022574249374326984)1:0.09397775961008659,((((SebastesserranoidesSEB-259_olive.1,SebastesserranoidesSEB-259_olive.2)1:0.634036117646037,((7164-PS-0002_black.2,7164-PS-0002_black.1)1:0.14127251170426933,(7164-PS-0005_yellowtail.2,7164-PS-0005_yellowtail.1)1:0.16187909386465774)1:0.27839427557004387)1:0.375885637151295,(((SebastesmystinusSEB-254_blue.1,SebastesmystinusSEB-254_blue.2)1:0.12321509545298512,(m84185_240412_222911_s4_deacon.1,m84185_240412_222911_s4_deacon.2)1:0.12685842213153758)1:0.41165127775658406,(widow-ccgp.2,(widow-ccgp.1,(7164-PS-0004_widow.2,7164-PS-0004_widow.1)0.64:0.01091967745174437)0.56:0.00910280773395564)1:0.5998306622866464)1:0.3126707355155873)1:0.17327365209439646,(((SebastescrocotulusSEB-252_sunset.2,SebastescrocotulusSEB-252_sunset.1)0.99:0.031554477405261835,(SebastesminiatusSEB-256_vermilion.1,SebastesminiatusSEB-256_vermilion.2)0.87:0.0203201935266721)1:0.9262808380981956,((bocaccio-ccgp.2,bocaccio-ccgp.1)1:1.3724319678578847,(((honeycomb-vgp.1,honeycomb-vgp.2)1:0.7648123672070336,(Sebastesruberrimus12-Yellowye1a.2,Sebastesruberrimus12-Yellowye1a.1)1:0.7770253573946146)0.85:0.018875817296964165,(((7164-PS-0001_copper.2,7164-PS-0001_copper.1)1:0.15990403887356056,(7164-PS-0008_quillback.1,7164-PS-0008_quillback.2)1:0.1253432887470529)0.96:0.027077051620424942,(SebastescarnatusSEB-258_gopher.1,SebastescarnatusSEB-258_gopher.2)1:0.084268971884613)1:0.8079329630215969)0.5:0.006549751018274216)0.45:0.007248848743529533)1:0.0845141623452026)1:0.06663058235339567)1:0.08966557643352899):0.0); 

7164-PS-0001_copper.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/7164-PS-0001_copper.fa.masked.hap1
7164-PS-0001_copper.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/7164-PS-0001_copper.fa.masked.hap2
7164-PS-0002_black.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/7164-PS-0002_black.fa.masked.hap1
7164-PS-0002_black.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/7164-PS-0002_black.fa.masked.hap2
7164-PS-0003_rougheye.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/7164-PS-0003_rougheye.fa.masked.hap1
7164-PS-0003_rougheye.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/7164-PS-0003_rougheye.fa.masked.hap2
7164-PS-0004_widow.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/7164-PS-0004_widow.fa.masked.hap1
7164-PS-0004_widow.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/7164-PS-0004_widow.fa.masked.hap2
7164-PS-0005_yellowtail.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/7164-PS-0005_yellowtail.fa.masked.hap1
7164-PS-0005_yellowtail.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/7164-PS-0005_yellowtail.fa.masked.hap2
7164-PS-0006_popb.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/7164-PS-0006_popb.fa.masked.hap1
7164-PS-0006_popb.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/7164-PS-0006_popb.fa.masked.hap2
7164-PS-0007_lightdusky.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/7164-PS-0007_lightdusky.fa.masked.hap1
7164-PS-0007_lightdusky.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/7164-PS-0007_lightdusky.fa.masked.hap2
7164-PS-0008_quillback.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/7164-PS-0008_quillback.fa.masked.hap1
7164-PS-0008_quillback.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/7164-PS-0008_quillback.fa.masked.hap2
m84185_240412_222911_s4_deacon.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/m84185_240412_222911_s4_deacon.fa.masked.hap1
m84185_240412_222911_s4_deacon.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/m84185_240412_222911_s4_deacon.fa.masked.hap2
SebastesalascanusSEB-2_shortspinethornyhead.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/SebastesalascanusSEB-2_shortspinethornyhead.fa.masked.hap1
SebastesalascanusSEB-2_shortspinethornyhead.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/SebastesalascanusSEB-2_shortspinethornyhead.fa.masked.hap2
SebastesalutusPOP6_popa.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/SebastesalutusPOP6_popa.fa.masked.hap1
SebastesalutusPOP6_popa.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/SebastesalutusPOP6_popa.fa.masked.hap2
SebastesborealisSEB-8_shortraker.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/SebastesborealisSEB-8_shortraker.fa.masked.hap1
SebastesborealisSEB-8_shortraker.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/SebastesborealisSEB-8_shortraker.fa.masked.hap2
SebastescarnatusSEB-258_gopher.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/SebastescarnatusSEB-258_gopher.fa.masked.hap1
SebastescarnatusSEB-258_gopher.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/SebastescarnatusSEB-258_gopher.fa.masked.hap2
SebastescrocotulusSEB-252_sunset.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/SebastescrocotulusSEB-252_sunset.fa.masked.hap1
SebastescrocotulusSEB-252_sunset.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/SebastescrocotulusSEB-252_sunset.fa.masked.hap2
SebastesmelanostictusSEB-4_blackspotted.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/SebastesmelanostictusSEB-4_blackspotted.fa.masked.hap1
SebastesmelanostictusSEB-4_blackspotted.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/SebastesmelanostictusSEB-4_blackspotted.fa.masked.hap2
SebastesminiatusSEB-256_vermilion.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/SebastesminiatusSEB-256_vermilion.fa.masked.hap1
SebastesminiatusSEB-256_vermilion.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/SebastesminiatusSEB-256_vermilion.fa.masked.hap2
SebastesmystinusSEB-254_blue.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/SebastesmystinusSEB-254_blue.fa.masked.hap1
SebastesmystinusSEB-254_blue.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/SebastesmystinusSEB-254_blue.fa.masked.hap2
SebastespolyspinisSEB-5_northern.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/SebastespolyspinisSEB-5_northern.fa.masked.hap1
SebastespolyspinisSEB-5_northern.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/SebastespolyspinisSEB-5_northern.fa.masked.hap2
Sebastesruberrimus12-Yellowye1a.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/Sebastesruberrimus12-Yellowye1a.fa.masked.hap1
Sebastesruberrimus12-Yellowye1a.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/Sebastesruberrimus12-Yellowye1a.fa.masked.hap2
SebastesserranoidesSEB-259_olive.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/SebastesserranoidesSEB-259_olive.fa.masked.hap1
SebastesserranoidesSEB-259_olive.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/SebastesserranoidesSEB-259_olive.fa.masked.hap2
bocaccio-ccgp.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/bocaccio-ccgp.fa.masked.hap1
bocaccio-ccgp.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/bocaccio-ccgp.fa.masked.hap2
widow-ccgp.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/widow-ccgp.fa.masked.hap1
widow-ccgp.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/widow-ccgp.fa.masked.hap2
acadian-vgp.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/acadian-vgp.fa.masked.hap1
acadian-vgp.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/acadian-vgp.fa.masked.hap2
honeycomb-vgp.1 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/honeycomb-vgp.fa.masked.hap1
honeycomb-vgp.2 /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap2_masked_fastas/honeycomb-vgp.fa.masked.hap2
Sebastes_aleutianus_rougheye /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/Sebastes_aleutianus_rougheye.rohit.fa.hap1
Ssc.HIC_korean /global/scratch/users/rdekayne/rockfish50/01_BUSCOS/hap1_masked_fastas/Ssc.HIC_korean.fa.hap1


cd /global/scratch/users/rdekayne/rockfish/03_CACTUS/cactus
source cactus_env/bin/activate
cd /global/scratch/users/rdekayne/rockfish50/03_CACTUS

##run50cactus.sh
#!/bin/bash
#SBATCH --job-name=cactus_50
#SBATCH --time=7-00:00:00 # Wall clock time limit in Days-Hours:min:seconds
#SBATCH --account=co_genomicdata
#SBATCH --partition=savio4_htc
#SBATCH --qos=genomicdata_htc4_normal
#SBATCH --output=cactus_test%j.out # output file
#SBATCH --error=cactus_test%j.err # error file
#SBATCH --ntasks=1 # Run 1 job
#SBATCH --ntasks-per-node=1 # One task per computer
#SBATCH --cpus-per-task=56 # 2 CPUs per job

singularity exec ../../rockfish/03_CACTUS/cactus_v2.9.3.sif cactus ./js ./cactus_input_50rockfish.txt ./50_rockfish.hal --binariesMode singularity

##RUN
sbatch run50cactus.sh


#run_halval_and_halstat.sh

#!/bin/bash
#SBATCH --job-name=cactus_val_stat
#SBATCH --time=0-24:00:00 # Wall clock time limit in Days-Hours:min:seconds
#SBATCH --account=co_genomicdata
#SBATCH --partition=savio4_htc
#SBATCH --output=cactus_test%j.out # output file
#SBATCH --error=cactus_test%j.err # error file
#SBATCH --ntasks=1 # Run 1 job
#SBATCH --ntasks-per-node=1 # One task per computer
#SBATCH --cpus-per-task=24 # 2 CPUs per job

singularity pull docker://quay.io/comparative-genomics-toolkit/cactus:v2.9.3
singularity run cactus_v2.9.3.sif
halValidate ./50_rockfish.hal
halStats ./50_rockfish.hal

##run
sbatch run_halval_and_halstat.sh

hal v2.2
(Ssc.HIC_korean:1,((SebastesalascanusSEB-2_shortspinethornyhead.1:1,SebastesalascanusSEB-2_shortspinethornyhead.2:1)Anc02:4.08443,((((SebastesborealisSEB-8_shortraker.1:1,SebastesborealisSEB-8_shortraker.2:1)Anc09:0.778924,((SebastesmelanostictusSEB-4_blackspotted.1:1,SebastesmelanostictusSEB-4_blackspotted.2:1)Anc16:0.224331,(Sebastes_aleutianus_rougheye:1,(7164-PS-0003_rougheye.1:1,7164-PS-0003_rougheye.2:1)0.84:0.0200833)Anc17:0.282865)Anc10:0.297968)Anc06:0.0977467,((acadian-vgp.2:1,acadian-vgp.1:1)Anc11:1.26132,(((7164-PS-0006_popb.1:1,7164-PS-0006_popb.2:1)0.99:0.0316936,(SebastesalutusPOP6_popa.1:1,SebastesalutusPOP6_popa.2:1)0.85:0.0196784)Anc18:0.714153,((SebastespolyspinisSEB-5_northern.1:1,SebastespolyspinisSEB-5_northern.2:1)Anc26:0.332595,(7164-PS-0007_lightdusky.1:1,7164-PS-0007_lightdusky.2:1)Anc27:0.351699)Anc19:0.459831)Anc12:0.149604)0.92:0.0225742)Anc04:0.0939778,((((SebastesserranoidesSEB-259_olive.1:1,SebastesserranoidesSEB-259_olive.2:1)Anc20:0.634036,((7164-PS-0002_black.2:1,7164-PS-0002_black.1:1)Anc28:0.141273,(7164-PS-0005_yellowtail.2:1,7164-PS-0005_yellowtail.1:1)Anc29:0.161879)Anc21:0.278394)Anc13:0.375886,(((SebastesmystinusSEB-254_blue.1:1,SebastesmystinusSEB-254_blue.2:1)Anc30:0.123215,(m84185_240412_222911_s4_deacon.1:1,m84185_240412_222911_s4_deacon.2:1)Anc31:0.126858)Anc22:0.411651,(widow-ccgp.2:1,(widow-ccgp.1:1,(7164-PS-0004_widow.2:1,7164-PS-0004_widow.1:1)0.64:0.0109197)0.56:0.00910281)Anc23:0.599831)Anc14:0.312671)Anc07:0.173274,(((SebastescrocotulusSEB-252_sunset.2:1,SebastescrocotulusSEB-252_sunset.1:1)Anc24:0.0315545,(SebastesminiatusSEB-256_vermilion.1:1,SebastesminiatusSEB-256_vermilion.2:1)0.87:0.0203202)Anc15:0.926281,((bocaccio-ccgp.2:1,bocaccio-ccgp.1:1)Anc25:1.37243,(((honeycomb-vgp.1:1,honeycomb-vgp.2:1)Anc34:0.764812,(Sebastesruberrimus12-Yellowye1a.2:1,Sebastesruberrimus12-Yellowye1a.1:1)Anc35:0.777025)Anc32:0.0188758,(((7164-PS-0001_copper.2:1,7164-PS-0001_copper.1:1)Anc37:0.159904,(7164-PS-0008_quillback.1:1,7164-PS-0008_quillback.2:1)Anc38:0.125343)0.96:0.0270771,(SebastescarnatusSEB-258_gopher.1:1,SebastescarnatusSEB-258_gopher.2:1)Anc36:0.084269)Anc33:0.807933)0.5:0.00654975)0.45:0.00724885)Anc08:0.0845142)Anc05:0.0666306)Anc03:0.0896656)Anc01:0)Anc00;

GenomeName, NumChildren, Length, NumSequences, NumTopSegments, NumBottomSegments
Anc00, 2, 719235129, 5568, 0, 4863155
Ssc.HIC_korean, 0, 811820114, 66, 6768794, 0
Anc01, 2, 741769193, 6918, 5578715, 25028803
Anc02, 2, 820695938, 2466, 24958770, 25808917
SebastesalascanusSEB-2_shortspinethornyhead.1, 0, 905231230, 830, 26940358, 0
SebastesalascanusSEB-2_shortspinethornyhead.2, 0, 898607308, 486, 26858464, 0
Anc03, 2, 759064686, 2871, 25477306, 8574058
Anc04, 2, 761284201, 3788, 8615629, 4155497
Anc06, 2, 770286810, 7222, 4239527, 8430193
Anc09, 2, 823162489, 3342, 8724068, 10175368
SebastesborealisSEB-8_shortraker.1, 0, 868195673, 394, 10682164, 0
SebastesborealisSEB-8_shortraker.2, 0, 856451237, 320, 10587638, 0
Anc10, 2, 779289844, 4439, 8592991, 6104844
Anc16, 2, 811976832, 2019, 6363697, 5400096
SebastesmelanostictusSEB-4_blackspotted.1, 0, 845822841, 400, 5705714, 0
SebastesmelanostictusSEB-4_blackspotted.2, 0, 847168328, 288, 5735484, 0
Anc17, 2, 791406845, 3206, 6281396, 3789121
Sebastes_aleutianus_rougheye, 0, 807295316, 168, 4052343, 0
0.84, 2, 811559190, 1760, 3912677, 3288574
7164-PS-0003_rougheye.1, 0, 840643646, 343, 3558582, 0
7164-PS-0003_rougheye.2, 0, 838320888, 272, 3542416, 0
0.92, 2, 761293125, 7422, 4169142, 8753412
Anc11, 2, 787032310, 3555, 8835284, 10052995
acadian-vgp.2, 0, 834216046, 11377, 10650369, 0
acadian-vgp.1, 0, 833835073, 203, 10561980, 0
Anc12, 2, 765570117, 5796, 8912973, 8773037
Anc18, 2, 785980057, 1013, 8959743, 7250754
0.99, 2, 804240111, 1839, 7327347, 3490495
7164-PS-0006_popb.1, 0, 832589343, 406, 3748101, 0
7164-PS-0006_popb.2, 0, 831158738, 298, 3769978, 0
0.85, 2, 801915285, 1903, 7331125, 3545127
SebastesalutusPOP6_popa.1, 0, 834628744, 415, 3838955, 0
SebastesalutusPOP6_popa.2, 0, 827943077, 267, 3848647, 0
Anc19, 2, 782688028, 4807, 8950536, 7905134
Anc26, 2, 814982621, 2847, 8263835, 5143915
SebastespolyspinisSEB-5_northern.1, 0, 857072336, 686, 5559104, 0
SebastespolyspinisSEB-5_northern.2, 0, 850539238, 495, 5522686, 0
Anc27, 2, 816218841, 2672, 8236492, 5214401
7164-PS-0007_lightdusky.1, 0, 854959545, 482, 5599533, 0
7164-PS-0007_lightdusky.2, 0, 852218155, 436, 5608051, 0
Anc05, 2, 758635452, 5155, 8567434, 3930962
Anc07, 2, 760146060, 6476, 4009134, 7270109
Anc13, 2, 768564332, 5428, 7372113, 7530333
Anc20, 2, 797585894, 1983, 7706090, 4180651
SebastesserranoidesSEB-259_olive.1, 0, 819086719, 323, 4423164, 0
SebastesserranoidesSEB-259_olive.2, 0, 808151341, 258, 4393265, 0
Anc21, 2, 782570013, 2908, 7706829, 3942409
Anc28, 2, 801014554, 1777, 4076802, 3177769
7164-PS-0002_black.2, 0, 819728571, 229, 3391388, 0
7164-PS-0002_black.1, 0, 824879497, 326, 3413816, 0
Anc29, 2, 804979343, 1862, 4105383, 3205852
7164-PS-0005_yellowtail.2, 0, 826024292, 237, 3431083, 0
7164-PS-0005_yellowtail.1, 0, 825976342, 246, 3457120, 0
Anc14, 2, 768348708, 4306, 7458783, 7792193
Anc22, 2, 778978894, 1946, 7934977, 4603640
Anc30, 2, 792886504, 1496, 4714809, 3042661
SebastesmystinusSEB-254_blue.1, 0, 815942818, 357, 3308089, 0
SebastesmystinusSEB-254_blue.2, 0, 808685107, 207, 3303693, 0
Anc31, 2, 793557979, 1342, 4746831, 3048343
m84185_240412_222911_s4_deacon.1, 0, 818546751, 405, 3328330, 0
m84185_240412_222911_s4_deacon.2, 0, 803447924, 232, 3232248, 0
Anc23, 2, 785533689, 2837, 7980105, 4217927
widow-ccgp.2, 0, 819589554, 76, 4543671, 0
0.56, 2, 792753661, 1548, 4352245, 1666923
widow-ccgp.1, 0, 823288076, 99, 1924952, 0
0.64, 2, 799165292, 1186, 1786440, 1947423
7164-PS-0004_widow.2, 0, 817325854, 433, 2140536, 0
7164-PS-0004_widow.1, 0, 823643762, 465, 2188929, 0
Anc08, 2, 758370405, 7149, 3977190, 6204211
Anc15, 2, 784582226, 1248, 6555355, 6498656
Anc24, 2, 796231018, 1081, 6573009, 2336397
SebastescrocotulusSEB-252_sunset.2, 0, 808865600, 227, 2538786, 0
SebastescrocotulusSEB-252_sunset.1, 0, 814979766, 273, 2597550, 0
0.87, 2, 795079833, 1182, 6580662, 2332103
SebastesminiatusSEB-256_vermilion.1, 0, 806861881, 277, 2567572, 0
SebastesminiatusSEB-256_vermilion.2, 0, 806086016, 215, 2577200, 0
0.45, 2, 758119527, 6105, 6244146, 7580114
Anc25, 2, 784763179, 1063, 7614099, 10574579
bocaccio-ccgp.2, 0, 802857081, 115, 10779442, 0
bocaccio-ccgp.1, 0, 806866550, 211, 10846674, 0
0.5, 2, 761514845, 5644, 7706379, 7642758
Anc32, 2, 766789307, 5145, 7746001, 9328028
Anc34, 2, 772779374, 2720, 9332892, 11704540
honeycomb-vgp.1, 0, 800904020, 138, 12143582, 0
honeycomb-vgp.2, 0, 765970641, 2131, 11862436, 0
Anc35, 2, 790047756, 1752, 9608184, 9882389
Sebastesruberrimus12-Yellowye1a.2, 0, 809345556, 197, 10098710, 0
Sebastesruberrimus12-Yellowye1a.1, 0, 812606353, 273, 10167924, 0
Anc33, 2, 776428543, 1543, 7783415, 5749760
0.96, 2, 782197606, 2086, 5796107, 2656811
Anc37, 2, 799160382, 1891, 2781664, 3641958
7164-PS-0001_copper.2, 0, 822240001, 336, 3878384, 0
7164-PS-0001_copper.1, 0, 825606643, 368, 3914709, 0
Anc38, 2, 803527785, 1813, 2816390, 3593549
7164-PS-0008_quillback.1, 0, 823700023, 367, 3837412, 0
7164-PS-0008_quillback.2, 0, 824338920, 270, 3858298, 0
Anc36, 2, 797570388, 1620, 5902499, 3802612
SebastescarnatusSEB-258_gopher.1, 0, 834936096, 381, 4091194, 0
SebastescarnatusSEB-258_gopher.2, 0, 820708855, 163, 4021418, 0

#####################################
#####################################
#            04_HAL_TO_TREES
#####################################
#####################################

mkdir -p mkdir /global/scratch/users/rdekayne/rockfish50/04_HAL_TO_TREES && cd /global/scratch/users/rdekayne/rockfish50/04_HAL_TO_TREES

cp ../01_BUSCOS/hap1_masked_fastas/SebastesalascanusSEB-2_shortspinethornyhead.fa.masked.hap1 .
conda activate /global/scratch/users/rdekayne/envs/trees
samtools faidx SebastesalascanusSEB-2_shortspinethornyhead.fa.masked.hap1
cut -f1,2 SebastesalascanusSEB-2_shortspinethornyhead.fa.masked.hap1.fai > sizes.genome
bedtools makewindows -g sizes.genome -w 100000 > 100kb.txt

cd /global/scratch/users/rdekayne/rockfish/03_CACTUS/cactus
source cactus_env/bin/activate
mkdir -p /global/scratch/users/rdekayne/rockfish50/04_HAL_TO_TREES/maf_run100 && cd /global/scratch/users/rdekayne/rockfish50/04_HAL_TO_TREES/maf_run100

#run_hal2maf_windows.sh
#!/bin/bash
#SBATCH --job-name=cactus_100kb
#SBATCH --time=0-24:00:00 # Wall clock time limit in Days-Hours:min:seconds
#SBATCH --account=co_genomicdata
#SBATCH --partition=savio4_htc
#SBATCH --output=cactus_test%j.out # output file
#SBATCH --error=cactus_test%j.err # error file
#SBATCH --ntasks=1 # Run 1 job
#SBATCH --mem=100G
#SBATCH --ntasks-per-node=1 # One task per computer
#SBATCH --cpus-per-task=24 # 2 CPUs per job

export TMPDIR=/global/scratch/users/rdekayne/rockfish50/04_HAL_TO_TREES/test_tmp

numb=${SLURM_ARRAY_TASK_ID}

cat /global/scratch/users/rdekayne/rockfish50/04_HAL_TO_TREES/h1tg000001l_windows.txt | sed -n ${numb}p > ${numb}.bed

singularity exec -B /global/scratch/users/rdekayne/rockfish50/04_HAL_TO_TREES/test_tmp ../03_CACTUS/cactus_v2.9.3.sif cactus-hal2maf ./${numb}_js ../03_CACTUS/50_rockfish.hal ${numb}.maf --refGenome SebastesalascanusSEB-2_shortspinethornyhead.1 --noAncestors --bedRanges ${numb}.bed --chunkSize 1000000 --batchMemory 25G --maxMemory 50G

###run
sbatch --array=1-230%10 run_hal2maf_windows.sh
